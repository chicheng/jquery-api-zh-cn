<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>jQuery 中文参考</title>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>
</head>
<body>
	<pre>
&lt;?xml version='1.0' encoding='utf-8'?&gt;
&lt;?xml-stylesheet type='text/xsl' href='style/cat.xsl'?&gt;
</pre>
	<pre id="xml">本页面需要firefox 3.0+ 支持</pre>
	<script type="text/javascript">
	<!--
		//加载xml
		$.get("index.html",function(xml) {
			//生成根节点
			var docs=<docs version='1.3' />;
			//获取大类
			var menuitem=$(xml).find(".menuitem");
			menuitem.each(function(i,e) {
				//大类插入根节点
				docs.appendChild(<cat value={e.innerHTML}/>);
				//获取函数名
				var functionitem=$(e).next().find(".functionitem");
				functionitem.each(function(j,e) {
					//函数内容
					var content=$(e).next()
					//将函数插入大类节点
					docs.cat[i].appendChild(
						<method
							type={content.find("h2:contains(返回值)").next().text()}
							short=""
							name={e.innerHTML.replace(/\(.*?\)/,"")}
						/>
					);
					//函数说明
					var longdesc=(content.find(".longdesc")
									.html()||"")
										.replace(/<br *?\/?>/gi,"")
										.replace(/<\/p><p>/gi,"\n\n")
										.replace(/<\/?p>|\t+/gi,"");
					if (longdesc) {
						docs.cat[i].method[j].desc='<![CDATA['+longdesc+']]>';
					}
					//参数
					var params=content.find("h2:contains(参数)");
					if (params[0]) {
						do {
							params=params.next()
							docs.cat[i].method[j].appendChild(
								<params
									name={params.find("strong").text().replace(/^\s*([^\s]*)\s*$/,"$1")}
									type={params.text().replace(/^.*?\((.*?)\).*?$/,"$1")
											.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
								>
									<desc>{params.html().replace(/^<strong>.*?<\/strong>\s*?\([^)]*?\)\s*?(:|：)\s*?/,"")}</desc>	
								</params>
							);
						} while (params.next()[0]&&params.next()[0].nodeName!="H2");
					}
					//示例
					var examples=content.find("h2:contains(示例)");
					if (examples[0]) {
						do {
							examples=examples.next();
							if (examples[0].nodeName=="P" && !/^<strong>.*?<\/strong>$/.test(examples.html())) {
								var example=<examples>
												<desc>{'<![CDATA['+examples.html().replace(/\t+/g,"")+']]>'}</desc>
											</examples>;
								var before=examples.nextAll(":contains(HTML 代码)");
								if (before[0]) {
									before=before.eq(0).next();
									example.appendChild(
										<before>
											{'<![CDATA['+before.html()
												.replace(/<br *?\/?>/gi,"")
												.replace(/<\/?pre>|\t+/gi,"")+']]>'}
										</before>
									);
								}
								var code=examples.nextAll(":contains(jQuery 代码)");
								if (code[0]) {
									code=code.eq(0).next();
									example.appendChild(
										<code>
											{'<![CDATA['+code.html()
												.replace(/<br *?\/?>/gi,"")
												.replace(/<\/?pre>|\t+/gi,"")+']]>'}
										</code>
									);
								}
								var result=examples.nextAll(":contains(结果)");
								if (result[0]) {
									result=result.eq(0).next();
									example.appendChild(
										<result>
											{'<![CDATA['+result.html()
												.replace(/<br *?\/?>/gi,"")
												.replace(/<\/?pre>|\t+/gi,"")+']]>'}
										</result>
									);
								}
								docs.cat[i].method[j].appendChild(example);
							}
						} while (examples.next()[0]);
					}

					//TODO:英文说明
					var desc=content.find(".desc");
					if (desc.length==2) {
						docs.cat[i].method[j].@short=desc.eq(0).children().remove(".longdesc").end().text();
					}else {
						docs.cat[i].method[j].@short=desc.children(":not(.longdesc)").filter(function() {
							return /[\u4e00-\u9fa5]/.test(this.innerHTML)
						}).text();
					}
					//var desc=content.find(".desc").remove(".longdesc");
				});
			});
			//输出生成的docs
			$("#xml").text(docs.toString()
							.replace(/&amp;(lt|gt|nbsp|amp)/g,"&$1")
							.replace(/&nbsp;/g," ")
							.replace(/&lt;/g,"<")
							.replace(/&gt;/g,">")
							.replace(/(<!\[CDATA\[)\n/g,"$1")
							.replace(/\n(\]\]>)/g,"$1")
							//.replace(/(type=".*?)<([^>]+)>(.*?)"/,"$1&lt;$2&gt;$3\"")
							.replace(/ " /g,"\" ")
							);
			//console.log(docs.replace(/&amp;(lt;|gt;)/g,"&$1"));
		});
	//-->
	</script>
</body>
</html>
