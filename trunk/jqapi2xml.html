<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
	<title>jQuery 中文参考</title>
	<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>
</head>
<body>
	<p>本页面必须要求有firefox 3.0+以上环境，并带有firebug方可正常运行。</p>
	<button>get</button>
	<div id="xx"></div>
	<script type="text/javascript">
	<!--
		$("button").click(function(){
			//加载xml
			$.get("index.html",function(xml) {
				//生成根节点
				var docs=<docs version='1.1' />;
				//获取大类
				var menuitem=$(xml).find(".menuitem");
				menuitem.each(function(i,e) {
					//大类插入根节点
					docs.appendChild(<cat value={e.innerHTML}/>);
					//获取函数名
					var functionitem=$(e).next().find(".functionitem");
					functionitem.each(function(j,e) {
						//函数内容
						var content=$(e).next()
						//将函数插入大类节点
						docs.cat[i].appendChild(
							<method
								cat={docs.cat[i].@value}
								type={content.find("h2:contains(返回值)").next().text()}
								short=""
								name={e.innerHTML.replace(/\(.*\)/,"")}
							/>
						);
						//函数说明
						var longdesc=(content.find(".longdesc")
										.html()||"")
											.replace(/<br *\/?>/gi,"\n")
											.replace(/<\/p><p>/gi,"\n\n")
											.replace(/<\/p>|<p>/gi,"")
						if (longdesc) {
							docs.cat[i].method[j].desc=longdesc;
						}
						var params=content.find("h2:contains(参数)");
						if (params.length) {
							do {
								params=params.next()
								docs.cat[i].method[j].appendChild(
									<params
										name={params.find("strong").text()}
									>
										<desc>{params.text().replace("：","").replace(/\([^)]*\)/,"")}</desc>	
									</params>
								);
								//console.log(params.next())
							} while (params.next()[0].nodeName!="H2");
						}
						//docs.cat[i].method[j].@short=content.find(".desc").remove(".longdesc").eq(0).text()
					});
					//测试期间,只输出前三个大类
					if (i==2) {
						return false;
					}
				});
				//输出生成的docs
				console.log(docs);
			});
		});
	//-->
	</script>
</body>
</html>
